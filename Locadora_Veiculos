

CREATE DATABASE LOCADORA_INCOMPLETA;
GO
USE LOCADORA_INCOMPLETA;
GO
CREATE TABLE CLIENTE(
	CODIGO INT NOT NULL IDENTITY(1,1),
	NOME VARCHAR(50) NOT NULL,
	CONSTRAINT PK_CLIENTE PRIMARY KEY(CODIGO)
);
GO

CREATE TABLE VEICULO(
	CODIGO INT NOT NULL IDENTITY(1,1),
	PLACA CHAR(7) NOT NULL,
	CONSTRAINT PK_VEICULO PRIMARY KEY(CODIGO)
);
GO
CREATE TABLE LOCACAO(
	CODIGO INT NOT NULL IDENTITY(1,1),
	COD_VEICULO INT NOT NULL,
	COD_CLIENTE INT NOT NULL,
	CONSTRAINT PK_LOCACAO PRIMARY KEY(CODIGO)
);

-- a
ALTER TABLE LOCACAO ADD CONSTRAINT FK_LOCACAO_VEICULO FOREIGN KEY(COD_VEICULO)
	REFERENCES VEICULO(CODIGO);

ALTER TABLE LOCACAO ADD CONSTRAINT FK_LOCACAO_CLIENTE FOREIGN KEY(COD_CLIENTE)
	REFERENCES CLIENTE(CODIGO);

ALTER TABLE LOCACAO ADD DATA_HORA_RETIRADA DATETIME NOT NULL;
ALTER TABLE LOCACAO ADD DATA_HORA_DEVOLUCAO DATETIME NULL;
ALTER TABLE LOCACAO ADD VALOR_TOTAL REAL NULL;

ALTER TABLE VEICULO ADD MARCA VARCHAR(30) NOT NULL;
ALTER TABLE VEICULO ADD MODELO VARCHAR(30) NOT NULL;
ALTER TABLE VEICULO ADD ANO SMALLINT NOT NULL;
ALTER TABLE VEICULO ADD VALOR_DIARIA REAL NOT NULL;
ALTER TABLE VEICULO ADD KM INT NOT NULL;

ALTER TABLE CLIENTE ADD LOGRADOURO VARCHAR(50) NOT NULL;
ALTER TABLE CLIENTE ADD BAIRRO VARCHAR(30) NOT NULL;
ALTER TABLE CLIENTE ADD CIDADE VARCHAR(50) NOT NULL;
ALTER TABLE CLIENTE ADD UF CHAR(2) NOT NULL;
ALTER TABLE CLIENTE ADD CEP CHAR(8) NOT NULL;
ALTER TABLE CLIENTE ADD CELULAR CHAR(11) NOT NULL;
ALTER TABLE CLIENTE ADD EMAIL VARCHAR(50) NOT NULL;
ALTER TABLE CLIENTE ADD DATA_NASCIMENTO DATE NOT NULL;
ALTER TABLE CLIENTE ADD CPF CHAR(11) NOT NULL;

--B
ALTER TABLE LOCACAO ADD CONSTRAINT CK_LOCACAO_DATA_HORA_DEVOLUCAO 
	CHECK(DATA_HORA_DEVOLUCAO IS NULL OR DATA_HORA_DEVOLUCAO>=DATA_HORA_RETIRADA);

-- C
ALTER TABLE CLIENTE ADD CONSTRAINT UQ_CLIENTE_EMAIL UNIQUE(EMAIL);
ALTER TABLE CLIENTE ADD CONSTRAINT UQ_CLIENTE_CPF UNIQUE(CPF);
ALTER TABLE CLIENTE ADD CONSTRAINT UQ_CLIENTE_CELULAR UNIQUE(CELULAR);

-- D
ALTER TABLE CLIENTE ADD CONSTRAINT CK_CLIENTE_CPF CHECK(LEN(CPF)=11);

-- E
ALTER TABLE CLIENTE ADD CONSTRAINT CK_CLIENTE_DATA_NASCIMENTO
	CHECK(DATEDIFF(YEAR,DATA_NASCIMENTO,GETDATE())>=18);

-- F
ALTER TABLE VEICULO ADD CONSTRAINT CK_VEICULO_VALOR_DIARIA 
	CHECK(VALOR_DIARIA>=79);
